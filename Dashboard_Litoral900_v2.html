<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LITORAL 900 - Dashboard de Control de Calidad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        .bar { transition: all 0.3s ease; }
        .bar:hover { opacity: 0.8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // ============ THEME ============
        const THEME = {
            primary: '#0f172a',
            success: '#059669',
            danger: '#be123c',
            warning: '#f59e0b',
            info: '#3b82f6',
            neutral: '#64748b'
        };

        const COLORS_PRIORITY = {
            'Urgent': THEME.danger,
            'High': THEME.warning,
            'Medium': THEME.info,
            'Low': THEME.neutral
        };

        const COLORS_STATUS = {
            'Cerrado': THEME.success,
            'Iniciado': THEME.warning,
            'Abierto': THEME.danger,
            'Listo para revisi贸n': THEME.info
        };

        // ============ HELPERS ============
        const parseDate = (dateStr) => {
            if (!dateStr) return null;
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10) - 1;
                let year = parseInt(parts[2], 10);
                if (year < 100) year += 2000;
                return new Date(year, month, day);
            }
            return new Date(dateStr);
        };

        const parseCSV = (text) => {
            const rows = [];
            let currentRow = [];
            let currentVal = '';
            let inQuotes = false;

            const cleanText = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

            for (let i = 0; i < cleanText.length; i++) {
                const char = cleanText[i];
                const nextChar = cleanText[i + 1];

                if (inQuotes) {
                    if (char === '"' && nextChar === '"') {
                        currentVal += '"';
                        i++;
                    } else if (char === '"') {
                        inQuotes = false;
                    } else {
                        currentVal += char;
                    }
                } else {
                    if (char === '"') {
                        inQuotes = true;
                    } else if (char === ',') {
                        currentRow.push(currentVal.trim());
                        currentVal = '';
                    } else if (char === '\n') {
                        currentRow.push(currentVal.trim());
                        if (currentRow.some(c => c !== '')) rows.push(currentRow);
                        currentRow = [];
                        currentVal = '';
                    } else {
                        currentVal += char;
                    }
                }
            }

            if (currentVal || currentRow.length > 0) {
                currentRow.push(currentVal.trim());
                if (currentRow.some(c => c !== '')) rows.push(currentRow);
            }

            if (rows.length < 2) return [];

            const headers = rows[0].map(h => h.trim().replace(/^"|"$/g, ''));
            const result = [];

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row.length < Math.floor(headers.length * 0.5)) continue;

                const obj = {};
                headers.forEach((h, idx) => {
                    obj[h] = row[idx] || '';
                });

                obj._dateObj = parseDate(obj['Fecha de notificaci贸n'] || obj['Fecha de creaci贸n']);

                const locString = obj['Ubicaci贸n'] || '';
                const locParts = locString.split('>').map(s => s.trim());

                obj._torre = locParts[0] || 'General';
                obj._piso = locParts.find(p => {
                    const upper = p.toUpperCase();
                    return upper.includes('PISO') || upper.includes('SOTANO') || upper.includes('STANO') || upper.includes('NIVEL');
                }) || 'Sin definir';

                obj._departamento = locParts.find(p => {
                    const upper = p.toUpperCase();
                    return upper.includes('DPTO') || upper.includes('DP');
                }) || '';

                const specString = obj['Especialidad'] || '';
                const specMatch = specString.match(/^(\d+)/);
                obj._partidaCode = specMatch ? specMatch[1] : 'S/C';
                obj._partidaName = specString.replace(/^\d+\s-\s/, '').split('-')[0].trim();

                obj._tipoLabel = obj['Tipo'] || 'Otros';

                result.push(obj);
            }
            return result;
        };

        // ============ APP STATE ============
        let appData = [];
        let fileName = '';
        let filterType = 'All';

        // ============ RENDER FUNCTIONS ============
        function renderUploadScreen() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-6">
                    <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-12 text-center">
                        <div class="mb-8 flex justify-center">
                            <div class="h-20 w-20 bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl flex items-center justify-center shadow-lg">
                                <svg class="text-white w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <rect x="3" y="2" width="18" height="20" rx="2" ry="2"></rect>
                                    <line x1="9" y1="2" x2="9" y2="22"></line>
                                    <line x1="15" y1="2" x2="15" y2="22"></line>
                                </svg>
                            </div>
                        </div>
                        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">LITORAL 900</h1>
                        <p class="text-lg font-semibold text-slate-600 mt-2">Sistema de Control de Calidad</p>
                        <p class="text-sm text-slate-400 mt-1">An谩lisis en Tiempo Real de Observaciones</p>

                        <div class="mt-10 space-y-6">
                            <div class="p-10 border-2 border-dashed border-slate-300 rounded-xl hover:border-slate-800 hover:bg-slate-50 transition-all cursor-pointer relative group">
                                <input type="file" accept=".csv" id="fileInput" class="absolute inset-0 opacity-0 z-10 cursor-pointer" />
                                <svg class="mx-auto w-12 h-12 text-slate-400 group-hover:text-slate-800 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p class="mt-4 text-base font-semibold text-slate-700">Carga tu archivo CSV</p>
                                <p class="mt-1 text-sm text-slate-500">Exportado desde Procore</p>
                            </div>

                            <div class="relative">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-slate-300"></div>
                                </div>
                                <div class="relative flex justify-center text-sm">
                                    <span class="px-2 bg-white text-slate-500 font-medium">O prueba con</span>
                                </div>
                            </div>

                            <button id="demoBtn" class="w-full py-4 bg-gradient-to-r from-slate-900 to-slate-800 text-white rounded-xl font-bold text-lg hover:shadow-xl transition-all shadow-lg">
                                 Cargar Datos Demo
                            </button>
                        </div>
                        <p class="mt-8 text-xs text-slate-400">Dashboard profesional para Litoral 900</p>
                    </div>
                </div>
            `;
        }

        function calculateAnalytics(data, filter) {
            let filtered = data;
            if (filter !== 'All') {
                filtered = filtered.filter(d => d['Tipo'] === filter);
            }

            const total = filtered.length;
            const closed = filtered.filter(d => d['Estatus'] === 'Cerrado').length;
            const open = filtered.filter(d => d['Estatus'] === 'Abierto').length;
            const inProgress = filtered.filter(d => d['Estatus'] === 'Iniciado').length;
            const critical = filtered.filter(d => d['Prioridad'] === 'Urgent').length;

            const effectivenessRate = Math.round((closed / total) * 100) || 0;
            const criticalityIndex = Math.round((critical / total) * 100) || 0;

            // Status distribution
            const statusMap = {};
            filtered.forEach(row => {
                const status = row['Estatus'];
                statusMap[status] = (statusMap[status] || 0) + 1;
            });

            // Priority distribution
            const priorityMap = {};
            filtered.forEach(row => {
                const priority = row['Prioridad'];
                priorityMap[priority] = (priorityMap[priority] || 0) + 1;
            });

            // Floor distribution
            const floorMap = {};
            filtered.forEach(row => {
                let floor = row._piso.replace('TORRE>', '').trim();
                if (!floor || floor === 'Sin definir') floor = 'Exteriores';
                floorMap[floor] = (floorMap[floor] || 0) + 1;
            });

            // Type distribution
            const tipoMap = {};
            filtered.forEach(row => {
                const tipo = row._tipoLabel;
                tipoMap[tipo] = (tipoMap[tipo] || 0) + 1;
            });

            return {
                total, closed, open, inProgress, critical,
                effectivenessRate, criticalityIndex,
                statusMap, priorityMap, floorMap, tipoMap,
                raw: filtered
            };
        }

        function renderBarChart(data, maxVal, wide = false) {
            return Object.entries(data).map(([name, value]) => {
                const width = Math.max((value / maxVal) * 100, 8);
                const labelWidth = wide ? 'w-48' : 'w-24';
                return `
                    <div class="flex items-center gap-3 mb-3">
                        <div class="${labelWidth} text-sm text-slate-700 font-medium" title="${name}">${name}</div>
                        <div class="flex-1 bg-slate-100 rounded-full h-7 overflow-hidden">
                            <div class="bar h-full bg-slate-700 rounded-full flex items-center justify-end pr-3" style="width: ${width}%">
                                <span class="text-xs text-white font-bold">${value}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderStatusChart(statusMap) {
            const colors = { 'Cerrado': '#059669', 'Iniciado': '#f59e0b', 'Abierto': '#be123c', 'Listo para revisi贸n': '#3b82f6' };
            const total = Object.values(statusMap).reduce((a, b) => a + b, 0);
            
            return Object.entries(statusMap).map(([name, value]) => {
                const pct = Math.round((value / total) * 100);
                const color = colors[name] || '#64748b';
                return `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg mb-2">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: ${color}"></div>
                            <span class="text-sm font-medium text-slate-700">${name}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold text-slate-900">${value}</span>
                            <span class="text-xs text-slate-500">(${pct}%)</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderDashboard() {
            const analytics = calculateAnalytics(appData, filterType);
            const maxFloor = Math.max(...Object.values(analytics.floorMap));
            const maxTipo = Math.max(...Object.values(analytics.tipoMap));

            const types = ['All', ...new Set(appData.map(d => d['Tipo']))];

            return `
                <div class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
                    <!-- Header -->
                    <header class="bg-gradient-to-r from-slate-900 to-slate-800 text-white shadow-lg sticky top-0 z-30" style="border-bottom: 4px solid #d97706">
                        <div class="max-w-7xl mx-auto px-6 py-5 flex items-center justify-between flex-wrap gap-4">
                            <div class="flex items-center gap-4">
                                <div class="bg-white/10 p-3 rounded-lg">
                                    <svg class="text-amber-400 w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <rect x="3" y="2" width="18" height="20" rx="2" ry="2"></rect>
                                    </svg>
                                </div>
                                <div>
                                    <h1 class="font-bold text-2xl tracking-wide">LITORAL 900</h1>
                                    <p class="text-xs text-slate-300 uppercase tracking-widest">Dashboard de Control de Calidad</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-right">
                                    <p class="text-xs text-slate-300 uppercase">Archivo</p>
                                    <p class="text-sm font-mono text-amber-300">${fileName.slice(0, 25)}${fileName.length > 25 ? '...' : ''}</p>
                                </div>
                                <label class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-xs font-bold uppercase rounded-lg cursor-pointer">
                                     CSV
                                    <input type="file" accept=".csv" id="fileInputHeader" class="hidden" />
                                </label>
                            </div>
                        </div>
                    </header>

                    <main class="max-w-7xl mx-auto px-6 pt-8 pb-12 space-y-8">
                        <!-- Filters -->
                        <div class="flex flex-wrap gap-2 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                            ${types.map(type => `
                                <button onclick="setFilter('${type}')" class="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all ${filterType === type ? 'bg-slate-900 text-white shadow-md' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}">
                                    ${type === 'All' ? ' Todos' : type}
                                </button>
                            `).join('')}
                        </div>

                        <!-- KPIs -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 border-l-4" style="border-left-color: #0f172a">
                                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Total Observaciones</p>
                                <h3 class="text-4xl font-extrabold text-slate-900 mt-2">${analytics.total}</h3>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 border-l-4" style="border-left-color: #be123c">
                                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Hallazgos Cr铆ticos</p>
                                <h3 class="text-4xl font-extrabold text-rose-600 mt-2">${analytics.critical}</h3>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 border-l-4" style="border-left-color: #059669">
                                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Efectividad</p>
                                <div class="flex items-baseline gap-1">
                                    <h3 class="text-4xl font-extrabold text-emerald-600 mt-2">${analytics.effectivenessRate}</h3>
                                    <span class="text-sm text-slate-500">%</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 border-l-4" style="border-left-color: #f59e0b">
                                <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">ndice Criticidad</p>
                                <div class="flex items-baseline gap-1">
                                    <h3 class="text-4xl font-extrabold text-amber-600 mt-2">${analytics.criticalityIndex}</h3>
                                    <span class="text-sm text-slate-500">%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Charts Row -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
                                <h3 class="font-bold text-slate-800 text-lg mb-4"> Distribuci贸n por Nivel</h3>
                                <div class="space-y-1">
                                    ${renderBarChart(analytics.floorMap, maxFloor)}
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
                                <h3 class="font-bold text-slate-800 text-lg mb-4"> Estado de Observaciones</h3>
                                <div>
                                    ${renderStatusChart(analytics.statusMap)}
                                </div>
                            </div>
                        </div>

                        <!-- Type Chart -->
                        <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
                            <h3 class="font-bold text-slate-800 text-lg mb-4"> Distribuci贸n por Tipo</h3>
                            <div class="grid grid-cols-1 gap-2">
                                ${renderBarChart(analytics.tipoMap, maxTipo, true)}
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                            <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white flex items-center justify-between">
                                <h3 class="font-bold text-lg text-slate-800"> Desglose Detallado</h3>
                                <span class="text-xs text-slate-500">Click en una fila para ver detalles</span>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-slate-600">
                                    <thead class="bg-slate-50 text-xs uppercase text-slate-500 font-bold border-b border-slate-200">
                                        <tr>
                                            <th class="px-4 py-4 w-8"></th>
                                            <th class="px-4 py-4">ID</th>
                                            <th class="px-4 py-4">Tipo</th>
                                            <th class="px-4 py-4">Ubicaci贸n</th>
                                            <th class="px-4 py-4">Prioridad</th>
                                            <th class="px-4 py-4">Estado</th>
                                            <th class="px-4 py-4">Fecha</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        ${analytics.raw.slice(0, 30).map((row, idx) => `
                                            <tr class="hover:bg-slate-50 transition-colors cursor-pointer" onclick="toggleRow(${idx})">
                                                <td class="px-4 py-3 text-slate-400">
                                                    <svg id="arrow-${idx}" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                </td>
                                                <td class="px-4 py-3 font-mono text-xs font-bold">#${row['N煤mero'] || 'N/A'}</td>
                                                <td class="px-4 py-3 text-xs">
                                                    <span class="px-2 py-1 bg-indigo-50 text-indigo-700 rounded text-xs font-bold">${row._tipoLabel}</span>
                                                </td>
                                                <td class="px-4 py-3 text-xs font-semibold">${row._piso}</td>
                                                <td class="px-4 py-3" style="color: ${COLORS_PRIORITY[row['Prioridad']] || '#64748b'}">
                                                    <span class="text-xs font-bold">${row['Prioridad'] || 'N/A'}</span>
                                                </td>
                                                <td class="px-4 py-3">
                                                    <span class="text-xs font-semibold" style="color: ${COLORS_STATUS[row['Estatus']] || '#64748b'}">
                                                        ${row['Estatus'] || 'N/A'}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 text-xs text-slate-400">
                                                    ${row._dateObj ? row._dateObj.toLocaleDateString('es-PE') : 'N/A'}
                                                </td>
                                            </tr>
                                            <tr id="detail-${idx}" class="hidden bg-slate-50">
                                                <td colspan="7" class="px-6 py-4">
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                                                            <p class="text-xs text-slate-500 uppercase font-bold mb-1"> T铆tulo / Descripci贸n</p>
                                                            <p class="text-slate-800 font-medium">${row['T铆tulo'] || row['Descripci贸n'] || 'Sin t铆tulo'}</p>
                                                        </div>
                                                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                                                            <p class="text-xs text-slate-500 uppercase font-bold mb-1"> Persona Asignada</p>
                                                            <p class="text-slate-800 font-medium">${row['Persona asignada'] || 'Sin asignar'}</p>
                                                            <p class="text-xs text-slate-500 mt-1">${row['Compa帽铆a de la persona asignada'] || ''}</p>
                                                        </div>
                                                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                                                            <p class="text-xs text-slate-500 uppercase font-bold mb-1"> Ubicaci贸n Completa</p>
                                                            <p class="text-slate-800 font-medium">${row['Ubicaci贸n'] || 'Sin ubicaci贸n'}</p>
                                                        </div>
                                                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                                                            <p class="text-xs text-slate-500 uppercase font-bold mb-1"> Especialidad</p>
                                                            <p class="text-slate-800 font-medium">${row['Especialidad'] || 'Sin especialidad'}</p>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        // ============ MAIN RENDER ============
        function render() {
            const root = document.getElementById('root');
            if (appData.length === 0) {
                root.innerHTML = renderUploadScreen();
                setupUploadListeners();
            } else {
                root.innerHTML = renderDashboard();
                setupDashboardListeners();
            }
        }

        function setupUploadListeners() {
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('demoBtn').addEventListener('click', loadDemoData);
        }

        function setupDashboardListeners() {
            const headerInput = document.getElementById('fileInputHeader');
            if (headerInput) {
                headerInput.addEventListener('change', handleFileUpload);
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                fileName = file.name;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const result = parseCSV(ev.target.result);
                        if (result.length === 0) {
                            alert("No se pudieron leer filas v谩lidas. Verifica el formato del CSV.");
                            return;
                        }
                        appData = result;
                        render();
                    } catch (err) {
                        console.error("Error parsing CSV:", err);
                        alert("Error procesando el archivo: " + err.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        function loadDemoData() {
            const demoRaw = `N煤mero,Tipo,Especialidad,T铆tulo,Persona asignada,Compa帽铆a de la persona asignada,Fecha de notificaci贸n,Estatus,Prioridad,Ubicaci贸n
428,Deficiencia,110 - PRO - Control de Calidad,Conexiones firmes y sin fugas,Edwin Aroni,ARONI,26/12/25,Iniciado,Urgent,TORRE>PISO 14>DPTO 1401
429,Deficiencia,110 - PRO - Control de Calidad,Fuga en lavadero,Edwin Aroni,ARONI,26/12/25,Iniciado,High,TORRE>PISO 14>DPTO 1402
430,Seguridad,111 - PRO - Seguridad Industrial,Falta baranda perim茅trica,Victor Andres,PADOVA,27/12/25,Abierto,Urgent,TORRE>PISO 15
431,Acabados,130 - PRO - Pintura,Retoque en muro cortina,Ana Gomez,PINTURAS SA,27/12/25,Cerrado,Medium,TORRE>PISO 05
432,El茅ctrico,120 - PRO - Electricidad,Tablero sin rotular,Maria L,ELECTRO,28/12/25,Iniciado,High,TORRE>PISO 08
433,Deficiencia,110 - PRO - Control de Calidad,Desnivel en contrapiso,Carlos R,CONCRETO MIX,28/12/25,Iniciado,Medium,TORRE>SOTANO 1
434,Seguridad,111 - PRO - Seguridad Industrial,Extintor vencido,Victor Andres,PADOVA,29/12/25,Abierto,High,TORRE>PISO 01
435,Deficiencia,110 - PRO - Control de Calidad,Ventana rayada,Luis Villa,VIDRIOS PERU,30/12/25,Cerrado,Low,TORRE>PISO 14
436,El茅ctrico,120 - PRO - Electricidad,Cable expuesto pasillo,Maria L,ELECTRO,02/01/26,Iniciado,Urgent,TORRE>PISO 02
437,Acabados,130 - PRO - Pintura,Mancha en cielo raso,Ana Gomez,PINTURAS SA,03/01/26,Iniciado,Medium,TORRE>PISO 14
438,Sanitario,140 - PRO - Sanitaria,Tuber铆as mal selladas,Pedro S谩nchez,SANITARIA PERU,04/01/26,Cerrado,Low,TORRE>PISO 10
439,Estructural,150 - PRO - Estructura,Grieta menor en muro,Roberto Lee,STRUCT ING,05/01/26,Iniciado,High,TORRE>PISO 03
440,Seguridad,111 - PRO - Seguridad Industrial,Salida de emergencia bloqueada,Victor Andres,PADOVA,05/01/26,Abierto,Urgent,TORRE>PISO 12
441,Deficiencia,110 - PRO - Control de Calidad,Piso rayado,Luis Villa,VIDRIOS PERU,06/01/26,Cerrado,Medium,TORRE>PISO 06
442,Acabados,130 - PRO - Pintura,Falta pintura en moldura,Ana Gomez,PINTURAS SA,06/01/26,Iniciado,Low,TORRE>PISO 07`;

            appData = parseCSV(demoRaw);
            fileName = 'LITORAL900_DEMO_26DIC2025.csv';
            render();
        }

        function setFilter(type) {
            filterType = type;
            render();
        }

        function toggleRow(idx) {
            const detailRow = document.getElementById(`detail-${idx}`);
            const arrow = document.getElementById(`arrow-${idx}`);
            
            if (detailRow.classList.contains('hidden')) {
                detailRow.classList.remove('hidden');
                arrow.style.transform = 'rotate(90deg)';
            } else {
                detailRow.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // ============ INIT ============
        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
